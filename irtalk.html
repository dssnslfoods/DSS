<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IR TALK Online event</title>

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    :root{
      /* Color balance: Orange 70% / Blue 15% / Green 15% */
      --bg-deep:#070b16;
      --card:#0b1224;
      --text:#f6f7ff;
      --muted:#c8cbe0;
      --border:rgba(255,255,255,.14);

      --orange:#ff7a18;
      --orange2:#ffb03a;

      --blue:#2f6bff;
      --green:#2dd477;

      --shadow: 0 22px 70px rgba(0,0,0,.58);
      --ring: 0 0 0 4px rgba(255,122,24,.16);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans Thai", "Noto Sans";
      color:var(--text);
      background:
        radial-gradient(1050px 680px at 18% 12%, rgba(255,122,24,.42), transparent 62%), /* orange dominant */
        radial-gradient(900px 620px at 86% 6%, rgba(47,107,255,.22), transparent 58%),  /* blue */
        radial-gradient(900px 620px at 78% 78%, rgba(45,212,119,.22), transparent 58%), /* green */
        linear-gradient(180deg, #070b16 0%, #040711 100%);
      padding:22px;
    }

    .wrap{max-width:860px;margin:0 auto}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid var(--border);
      border-radius:24px;
      padding:20px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      position:relative;
      overflow:hidden;
    }

    /* subtle glow stripe */
    .card:before{
      content:"";
      position:absolute;inset:-2px -2px auto -2px;height:140px;
      background: radial-gradient(600px 140px at 35% 40%, rgba(255,122,24,.55), transparent 70%);
      pointer-events:none;
      opacity:.9;
    }

    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:10px;
      position:relative;
      z-index:1;
    }

    .brand{
      display:flex;gap:12px;align-items:center;
      min-width:260px;
    }

    .logo{
      width:46px;height:46px;border-radius:16px;
      background: linear-gradient(135deg, rgba(255,122,24,1), rgba(255,176,58,1));
      box-shadow: 0 14px 34px rgba(0,0,0,.40);
      position:relative;
    }
    .logo:after{
      content:"";
      position:absolute;inset:10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.28);
      opacity:.7;
    }

    h1{
      margin:0;
      font-size:20px;
      letter-spacing:.2px;
      line-height:1.25;
    }
    .sub{
      margin:6px 0 0;
      color:rgba(255,255,255,.82);
      line-height:1.55;
      font-size:13px;
    }

    .event{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:10px;
      position:relative;
      z-index:1;
    }

    .tag{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.20);
      font-size:12.5px;
      color:#f3f5ff;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }

    .tag.orange{border-color:rgba(255,122,24,.35); background:rgba(255,122,24,.10)}
    .tag.blue{border-color:rgba(47,107,255,.35); background:rgba(47,107,255,.10)}
    .tag.green{border-color:rgba(45,212,119,.35); background:rgba(45,212,119,.10)}

    .meta{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;
      position:relative;z-index:1;
    }

    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      font-size:12.5px;
      color:#f2f4ff;
    }
    .pill strong{color:#ffffff}

    .divider{height:1px;background:rgba(255,255,255,.14);margin:14px 0;position:relative;z-index:1}

    form{
      display:grid;
      gap:12px;
      margin-top:12px;
      position:relative;
      z-index:1;
    }

    .row{display:grid;gap:7px}
    label{font-size:12.5px;color:rgba(255,255,255,.88)}
    .req{color:#ffd0b0;margin-left:6px}

    input{
      width:100%;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color:var(--text);
      outline:none;
      font-size:15px;
    }
    input:focus{
      border-color: rgba(255,122,24,.55);
      box-shadow: var(--ring);
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media(min-width:760px){
      .grid2{grid-template-columns: 1fr 1fr;}
    }

    .pdpa{
      margin-top:2px;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
    }
    .pdpa-line{display:flex;gap:10px;align-items:flex-start}
    .pdpa input[type="checkbox"]{width:18px;height:18px;margin-top:2px;accent-color: var(--orange)}
    .pdpa p{margin:0;color:rgba(255,255,255,.78);font-size:12.8px;line-height:1.55}

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:2px;
    }

    button{
      border:0;
      border-radius:16px;
      padding:12px 14px;
      font-size:15px;
      cursor:pointer;
      transition:.15s ease;
      user-select:none;
    }

    .btn-primary{
      background: linear-gradient(135deg, rgba(255,122,24,1), rgba(255,176,58,1));
      color:#1a0b00;
      font-weight:900;
      box-shadow: 0 14px 34px rgba(0,0,0,.35);
    }
    .btn-primary:hover{transform: translateY(-1px)}
    .btn-primary:disabled{opacity:.58;cursor:not-allowed;filter:grayscale(18%);transform:none}

    .btn-ghost{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
    }
    .btn-ghost:hover{border-color:rgba(255,122,24,.28)}

    .status{
      min-height:18px;
      font-size:12.8px;
      color:rgba(255,255,255,.78);
      line-height:1.45;
    }
    .status.ok{color:#b9ffd2}
    .status.err{color:#ffb4b4}

    .tiny{font-size:12px;color:rgba(255,255,255,.70);margin-top:8px}

    /* Modal */
    .backdrop{
      position:fixed;inset:0;
      background: rgba(0,0,0,.64);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:9999;
    }
    .modal{
      width:min(640px,100%);
      border-radius:24px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 26px 90px rgba(0,0,0,.65);
      padding:18px;
      backdrop-filter: blur(12px);
      position:relative;
      overflow:hidden;
    }
    .modal:before{
      content:"";
      position:absolute;inset:-2px -2px auto -2px;height:140px;
      background:
        radial-gradient(600px 140px at 35% 40%, rgba(255,122,24,.55), transparent 70%),
        radial-gradient(420px 120px at 75% 40%, rgba(47,107,255,.18), transparent 70%),
        radial-gradient(420px 120px at 92% 70%, rgba(45,212,119,.18), transparent 70%);
      pointer-events:none;
      opacity:.9;
    }
    .modal > *{position:relative;z-index:1}

    .modal h2{margin:0 0 8px;font-size:18px}
    .modal p{margin:0 0 12px;color:rgba(255,255,255,.82);line-height:1.6;font-size:13px}

    .linkbox{
      margin:10px 0 0;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      word-break:break-all;
      font-size:13px;
      color:#f2f4ff;
    }
    .linkbox a{color:#ffe1c8;text-decoration:underline}
    .modal .actions{justify-content:flex-end;margin-top:12px}

    .btn-teams{
      background: linear-gradient(135deg, rgba(47,107,255,1), rgba(255,122,24,.88));
      color:#061029;
      font-weight:900;
    }
    .btn-teams:hover{transform: translateY(-1px)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1>IR TALK Online event</h1>
            <p class="sub">
              ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            </p>
          </div>
        </div>
      </header>

      <div class="event">
        <div class="tag orange">üß° ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô: ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ‚Üí ‡∏£‡∏±‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</div>
        <div class="tag blue">üíô ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á: Microsoft Teams</div>
        <div class="tag green">üíö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢: Shared Secret</div>
      </div>

      <div class="meta">
        <div class="pill"><strong>LINE User ID:</strong> <span id="lineUserId">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‚Ä¶</span></div>
        <div class="pill"><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> <span id="liffStatus">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î</span></div>
      </div>

      <div class="divider"></div>

      <form id="regForm" autocomplete="on">
        <div class="row">
          <label for="fullName">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•<span class="req">*</span></label>
          <input id="fullName" name="fullName" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" />
        </div>

        <div class="grid2">
          <div class="row">
            <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
            <input id="phone" name="phone" inputmode="tel" placeholder="‡πÄ‡∏ä‡πà‡∏ô 08x-xxx-xxxx" />
          </div>

          <div class="row">
            <label for="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
            <input id="email" name="email" inputmode="email" type="email" placeholder="name@example.com" />
          </div>
        </div>

        <div class="row">
          <label for="company">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label>
          <input id="company" name="company" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô/‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô" />
        </div>

        <div class="pdpa">
          <div class="pdpa-line">
            <input id="pdpa" type="checkbox" />
            <div>
              <label for="pdpa" style="cursor:pointer">‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (PDPA Consent)</label>
              <p>
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
              </p>
            </div>
          </div>
        </div>

        <div class="actions">
          <button id="submitBtn" class="btn-primary" type="submit" disabled>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
          <button id="closeBtn" class="btn-ghost" type="button">‡∏õ‡∏¥‡∏î</button>
        </div>

        <div id="status" class="status" role="status" aria-live="polite"></div>
      </form>

      <p class="tiny">
        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå (‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≤‡∏à‡∏û‡∏≤‡πÑ‡∏õ Login LINE ‡∏Å‡πà‡∏≠‡∏ô)
      </p>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="backdrop" id="backdrop" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal">
      <h2 id="modalTitle">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h2>
      <p id="modalMsg">
        ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏á‡∏≤‡∏ô
      </p>

      <div class="linkbox">
        <div style="font-weight:900;margin-bottom:6px;">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° Microsoft Teams (‡∏ß‡∏±‡∏ô‡∏á‡∏≤‡∏ô)</div>
        <div id="teamsLinkText"></div>
      </div>

      <div class="actions">
        <button class="btn-teams" id="joinTeamsBtn" type="button">üîó ‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° Microsoft Teams</button>
        <button class="btn-primary" id="modalCloseBtn" type="button">‡∏õ‡∏¥‡∏î</button>
      </div>

      <p class="tiny">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡πÅ‡∏≠‡∏õ Microsoft Teams ‡∏ö‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏Å‡∏ß‡πà‡∏≤</p>
    </div>
  </div>

  <script>
    // =========================
    // CONFIG
    // =========================
    const LIFF_ID = "2008928307-8xnpCPKG";
    const N8N_WEBHOOK_URL = "https://def2design.app.n8n.cloud/webhook/liff/register";

    // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÉ‡∏ô n8n (IF node - Check Shared Secret)
    const SHARED_SECRET = "nsl-ir-liff-2026-secret-9xAqP!";

    const TEAMS_MEETING_URL =
      "https://teams.microsoft.com/meet/46284082130059?p=JSZyeiKXRfc9cu3oIn";

    // =========================
    // DOM helpers
    // =========================
    const $ = (id) => document.getElementById(id);
    const submitBtn = $("submitBtn");
    const statusEl = $("status");
    const pdpa = $("pdpa");
    const lineUserIdEl = $("lineUserId");
    const liffStatusEl = $("liffStatus");
    const backdrop = $("backdrop");
    const teamsLinkText = $("teamsLinkText");

    let liffProfile = null;
    let isSubmitting = false;

    function setStatus(msg, type) {
      statusEl.textContent = msg || "";
      statusEl.className = "status" + (type ? (" " + type) : "");
    }

    function openModal() {
      teamsLinkText.innerHTML =
        '<a href="' + TEAMS_MEETING_URL + '" target="_blank" rel="noopener noreferrer">' +
        TEAMS_MEETING_URL + '</a>';
      backdrop.style.display = "flex";
    }
    function closeModal() {
      backdrop.style.display = "none";
    }

    function safeCloseLiff() {
      try {
        if (window.liff && liff.isInClient()) liff.closeWindow();
        else window.close();
      } catch(e) {
        window.location.href = "about:blank";
      }
    }

    // PDPA gate
    pdpa.addEventListener("change", () => {
      submitBtn.disabled = !pdpa.checked || isSubmitting;
      if (!pdpa.checked) setStatus("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö PDPA ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", "");
      else setStatus("", "");
    });

    $("closeBtn").addEventListener("click", safeCloseLiff);
    $("modalCloseBtn").addEventListener("click", () => { closeModal(); safeCloseLiff(); });

    $("joinTeamsBtn").addEventListener("click", () => {
      window.open(TEAMS_MEETING_URL, "_blank", "noopener,noreferrer");
    });

    // =========================
    // LIFF init
    // =========================
    async function initLiff() {
      setStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE‚Ä¶", "");
      liffStatusEl.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‚Ä¶";

      try {
        await liff.init({ liffId: LIFF_ID });

        if (!liff.isLoggedIn()) {
          liffStatusEl.textContent = "‡∏ï‡πâ‡∏≠‡∏á Login LINE";
          setStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡πÑ‡∏õ Login LINE‚Ä¶", "");
          liff.login();
          return;
        }

        liffProfile = await liff.getProfile();
        lineUserIdEl.textContent = liffProfile?.userId || "-";
        liffStatusEl.textContent = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
        setStatus("", "ok");

      } catch (err) {
        console.error(err);
        lineUserIdEl.textContent = "-";
        liffStatusEl.textContent = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
        setStatus("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LIFF ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE", "err");
      }
    }

    // =========================
    // Submit
    // =========================
    $("regForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      if (isSubmitting) return;

      const fullName = $("fullName").value.trim();
      const phone = $("phone").value.trim();
      const email = $("email").value.trim();
      const company = $("company").value.trim();

      if (!fullName) return setStatus("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", "err");
      if (!pdpa.checked) return setStatus("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö PDPA ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", "err");

      isSubmitting = true;
      submitBtn.disabled = true;
      const originalText = submitBtn.textContent;
      submitBtn.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶";
      setStatus("", "");

      const payload = {
        source: "LIFF-IR-TALK",
        timestamp: new Date().toISOString(),

        // form fields
        fullName,
        phone,
        email,
        company,
        pdpaConsent: true,

        // line profile
        lineUserId: liffProfile?.userId || null,
        displayName: liffProfile?.displayName || null,
        pictureUrl: liffProfile?.pictureUrl || null,

        // meeting link (for downstream email/line confirm)
        teamsMeetingUrl: TEAMS_MEETING_URL,

        // context
        isInClient: (window.liff ? liff.isInClient() : null),
        language: (window.liff ? liff.getLanguage() : null),
        os: (window.liff ? liff.getOS() : null)
      };

      try {
        const res = await fetch(N8N_WEBHOOK_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-shared-secret": SHARED_SECRET
          },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const t = await res.text().catch(() => "");
          throw new Error("Webhook error: " + res.status + " " + t);
        }

        setStatus("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "ok");
        openModal();

      } catch (err) {
        console.error(err);
        setStatus("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", "err");
        isSubmitting = false;
        submitBtn.textContent = originalText;
        submitBtn.disabled = !pdpa.checked ? true : false;
        return;
      } finally {
        submitBtn.textContent = originalText;
      }
    });

    // boot
    initLiff();
  </script>
</body>
</html>
