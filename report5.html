<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bake A Wish Sales Analysis Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Prompt', sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .gradient-header { background: linear-gradient(135deg, #2C3E50 0%, #3498DB 100%); color: white; }
        .stat-value { font-size: 1.5rem; font-weight: 700; color: #1f2937; }
        .stat-label { font-size: 0.875rem; color: #6b7280; }
        .trend-up { color: #10b981; }
        .trend-down { color: #ef4444; }
    </style>
</head>
<body>

    <!-- Header Section -->
    <div class="gradient-header p-6 shadow-lg mb-8">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold mb-2"><i class="fas fa-chart-line mr-2"></i> Bake A Wish Sales Performance</h1>
                <p class="opacity-90">วิเคราะห์ยอดขายช่องทาง 7-11 (NSL Foods) | ข้อมูล: Aug - Oct 2025</p>
            </div>
            <div class="text-right hidden md:block">
                <!-- Updated attribution -->
                <div class="text-sm opacity-75">Prepared by</div>
                <div class="font-bold text-lg">DSS NSL</div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 pb-12">
        
        <!-- Executive Summary Box -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8 border-l-4 border-green-500">
            <h2 class="text-xl font-bold text-gray-800 mb-4"><i class="fas fa-rocket text-green-600 mr-2"></i> Executive Summary</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-gray-700">
                <div>
                    <strong class="block text-lg mb-1 text-green-600">Outstanding Growth</strong>
                    <p class="text-sm">ยอดขายรวมเติบโตอย่างแข็งแกร่งต่อเนื่องทุกเดือน จาก 14M (Aug) สู่ 19M (Oct) คิดเป็นอัตราการเติบโตเฉลี่ยกว่า 16% ต่อเดือน</p>
                </div>
                <div>
                    <strong class="block text-lg mb-1 text-blue-600">Growth Driver</strong>
                    <p class="text-sm">การเติบโตหลักมาจากยอดขายส่วน General/New Customers (Unidentified) ซึ่งแสดงถึงความต้องการสินค้าในตลาดวงกว้าง</p>
                </div>
                <div>
                    <strong class="block text-lg mb-1 text-yellow-600">Action Focus</strong>
                    <p class="text-sm">ต้องเร่งทำ Conversion Program เพื่อเปลี่ยนกลุ่ม **New/General Customers** เข้าสู่ระบบสมาชิก (Loyalty/Normal) และต้องลดอัตรา **Churn 1 Mth** ด่วน</p>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="card p-5 border-t-4 border-blue-500">
                <div class="stat-label">Total Sales (Aug-Oct)</div>
                <div class="stat-value">฿49,681,063</div>
                <div class="text-xs text-gray-500 mt-1">ยอดรวม 3 เดือน</div>
            </div>
            <div class="card p-5 border-t-4 border-green-500">
                <div class="stat-label">Oct Sales (New High)</div>
                <div class="stat-value text-green-600">฿19,173,890</div>
                <div class="text-xs text-green-600 mt-1"><i class="fas fa-arrow-up"></i> +16.5% จาก Sep</div>
            </div>
            <div class="card p-5 border-t-4 border-indigo-500">
                <div class="stat-label">Growth Streak</div>
                <div class="stat-value text-indigo-700">2 Months</div>
                <div class="text-xs text-gray-500 mt-1">เติบโตต่อเนื่องตั้งแต่ Aug</div>
            </div>
            <div class="card p-5 border-t-4 border-orange-500">
                <div class="stat-label">Opportunity Gap</div>
                <div class="stat-value text-orange-600">~92%</div>
                <div class="text-xs text-gray-500 mt-1">ยอดขายจาก New/General Customers</div>
            </div>
        </div>

        <!-- Main Chart Section (Centered Pie Chart) -->
        <div class="max-w-3xl mx-auto mb-8">
            <div class="card p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4 text-center">สัดส่วนยอดขาย Oct (Breakdown by Customer Status)</h3>
                <div style="height: 350px;">
                    <canvas id="contributionChart"></canvas>
                </div>
                <div class="mt-4 text-sm text-gray-500 text-center">
                    <ul class="inline-flex space-x-6 list-none">
                        <li><span class="inline-block w-3 h-3 bg-gray-200 mr-1 rounded-full"></span> <strong>New/General Customers:</strong> 92%</li>
                        <li><span class="inline-block w-3 h-3 bg-blue-500 mr-1 rounded-full"></span> <strong>Identified Existing Customers:</strong> ~8%</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Deep Dive Section -->
        <div class="card p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800"><i class="fas fa-layer-group text-purple-600 mr-2"></i> Deep Dive: Customer Sales Status</h3>
                <span class="bg-purple-100 text-purple-800 text-xs font-semibold px-2.5 py-0.5 rounded">Migration and New Sales Analysis</span>
            </div>
            
            <p class="text-gray-600 mb-6">ตารางแสดงยอดขายที่เกิดขึ้นจริง โดยแบ่งตามสถานะลูกค้าจากเดือนที่แล้ว (Previous Period) สู่เดือนปัจจุบัน (Current Period)</p>

            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                        <tr>
                            <th scope="col" class="px-6 py-3">Customer Status (Previous → Current)</th>
                            <th scope="col" class="px-6 py-3 text-right">Aug Sales</th>
                            <th scope="col" class="px-6 py-3 text-right">Sep Sales</th>
                            <th scope="col" class="px-6 py-3 text-right">Oct Sales</th>
                            <th scope="col" class="px-6 py-3 text-center">Trend (Oct vs Sep)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-white border-b hover:bg-gray-50">
                            <th scope="row" class="px-6 py-4 font-medium text-gray-900">
                                <span class="text-green-600">Loyalty → Loyalty</span>
                                <div class="text-xs text-gray-400">กลุ่มขาประจำที่รักษาไว้ได้ (Retention)</div>
                            </th>
                            <td class="px-6 py-4 text-right">672,106</td>
                            <td class="px-6 py-4 text-right">579,926</td>
                            <td class="px-6 py-4 text-right">621,828</td>
                            <td class="px-6 py-4 text-center text-green-500 font-semibold"><i class="fas fa-caret-up"></i> +7.2%</td>
                        </tr>
                        <tr class="bg-white border-b hover:bg-gray-50">
                            <th scope="row" class="px-6 py-4 font-medium text-gray-900">
                                <span class="text-indigo-600">Normal → Loyalty</span>
                                <div class="text-xs text-gray-400">กลุ่มลูกค้า Upgraded (Conversion Success)</div>
                            </th>
                            <td class="px-6 py-4 text-right">375,092</td>
                            <td class="px-6 py-4 text-right">371,200</td>
                            <td class="px-6 py-4 text-right">390,983</td>
                            <td class="px-6 py-4 text-center text-green-500 font-semibold"><i class="fas fa-caret-up"></i> +5.3%</td>
                        </tr>
                        <tr class="bg-white border-b hover:bg-gray-50">
                            <th scope="row" class="px-6 py-4 font-medium text-gray-900">
                                <span class="text-yellow-600">Loyalty → Normal</span>
                                <div class="text-xs text-gray-400">กลุ่มลูกค้า Degraded (Slippage Warning)</div>
                            </th>
                            <td class="px-6 py-4 text-right">213,066</td>
                            <td class="px-6 py-4 text-right">159,719</td>
                            <td class="px-6 py-4 text-right">158,317</td>
                            <td class="px-6 py-4 text-center text-red-500 font-semibold"><i class="fas fa-caret-down"></i> -0.9%</td>
                        </tr>
                        <tr class="bg-white border-b hover:bg-gray-50">
                            <th scope="row" class="px-6 py-4 font-medium text-gray-900">
                                <span class="text-gray-600">Normal → Normal</span>
                                <div class="text-xs text-gray-400">กลุ่มลูกค้าขาจรซื้อซ้ำ (Basic Repeat)</div>
                            </th>
                            <td class="px-6 py-4 text-right">377,621</td>
                            <td class="px-6 py-4 text-right">320,107</td>
                            <td class="px-6 py-4 text-right">290,103</td>
                            <td class="px-6 py-4 text-center text-red-500 font-semibold"><i class="fas fa-caret-down"></i> -9.4%</td>
                        </tr>
                        <!-- Updated Row for New/General Sales -->
                        <tr class="bg-gray-100 border-b border-gray-300">
                            <th scope="row" class="px-6 py-4 font-medium text-blue-700 italic">
                                New/General Customers (Unidentified Sales)
                                <div class="text-xs font-normal text-blue-500">ยอดขายส่วนใหญ่ที่มาจากลูกค้าใหม่/ลูกค้าทั่วไป</div>
                            </th>
                            <td class="px-6 py-4 text-right italic text-blue-700 font-bold">12,417,354</td>
                            <td class="px-6 py-4 text-right italic text-blue-700 font-bold">15,020,982</td>
                            <td class="px-6 py-4 text-right italic text-blue-700 font-bold">17,712,659</td>
                            <td class="px-6 py-4 text-center text-green-600 font-semibold"><i class="fas fa-angle-double-up"></i> Strong Growth</td>
                        </tr>
                    </tbody>
                    <tfoot class="bg-gray-800 text-white">
                        <tr class="font-bold">
                            <th scope="row" class="px-6 py-4 text-base">GRAND TOTAL (ยอดขายรวมสุทธิ)</th>
                            <td class="px-6 py-4 text-right text-base">14,055,239</td>
                            <td class="px-6 py-4 text-right text-base">16,451,934</td>
                            <td class="px-6 py-4 text-right text-base text-green-400">19,173,890</td>
                            <td class="px-6 py-4 text-center"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- NEW Churn Status Tracking Section -->
        <div class="card p-6 mb-8 bg-red-50 border border-red-200">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-red-800"><i class="fas fa-user-times text-red-600 mr-2"></i> Churn Status Tracking (Member Count)</h3>
                <span class="bg-red-100 text-red-800 text-xs font-semibold px-2.5 py-0.5 rounded">Risk Management</span>
            </div>
            <p class="text-red-700 mb-4">แสดงจำนวนสมาชิกรวม (นับจาก #Member) ที่ **หยุดซื้อ** ไป 1 เดือน (ยอดขาย = 0) ในเดือนปัจจุบัน (Current Period: Churn 1 Mth.)</p>

            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-left text-gray-700">
                    <thead class="text-xs text-gray-600 uppercase bg-red-100">
                        <tr>
                            <th scope="col" class="px-6 py-3">Customer Status (Previous → Churn)</th>
                            <th scope="col" class="px-6 py-3 text-right">Aug (#Member)</th>
                            <th scope="col" class="px-6 py-3 text-right">Sep (#Member)</th>
                            <th scope="col" class="px-6 py-3 text-right">Oct (#Member)</th>
                            <th scope="col" class="px-6 py-3">Implication</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-white border-b hover:bg-red-50">
                            <th scope="row" class="px-6 py-4 font-medium text-gray-900">
                                <span class="text-red-600">Loyalty → Churn 1 Mth.</span>
                            </th>
                            <td class="px-6 py-4 text-right">18,431</td>
                            <td class="px-6 py-4 text-right">11,980</td>
                            <td class="px-6 py-4 text-right font-bold text-red-700">11,166</td>
                            <td class="px-6 py-4 text-xs text-red-600">แม้ตัวเลขจะลดลง แต่การเสีย Loyalty 11K/เดือน ยังเป็นสัญญาณอันตราย ต้องทำ Win Back</td>
                        </tr>
                        <tr class="bg-white hover:bg-red-50">
                            <th scope="row" class="px-6 py-4 font-medium text-gray-900">
                                <span class="text-red-600">Normal → Churn 1 Mth.</span>
                            </th>
                            <td class="px-6 py-4 text-right">59,205</td>
                            <td class="px-6 py-4 text-right">34,055</td>
                            <td class="px-6 py-4 text-right font-bold text-red-700">34,055</td>
                            <td class="px-6 py-4 text-xs text-red-600">การเสียลูกค้า Normal (ขาจร) เป็นตัวเลขที่สูงมาก ควรใช้โปรโมชั่นดึงดูดการซื้อครั้งที่ 2 ให้สำเร็จ</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        // --- Data Configuration ---
        const labels = ['Aug', 'Sep', 'Oct'];
        
        // Known Segments Data
        const dataLoyalToLoyal = [672106, 579926, 621828];
        const dataNormalToLoyal = [375092, 371200, 390983];
        const dataLoyalToNormal = [213066, 159719, 158317];
        const dataNormalToNormal = [377621, 320107, 290103];

        // Grand Totals (User Provided)
        const grandTotals = [14055239, 16451934, 19173890.58];

        // Calculate Others (Now representing New/General Customers)
        const dataOthers = grandTotals.map((total, i) => {
            const knownSum = dataLoyalToLoyal[i] + dataNormalToLoyal[i] + dataLoyalToNormal[i] + dataNormalToNormal[i];
            return total - knownSum;
        });

        // --- Chart: October Contribution (Doughnut) ---
        const ctxPie = document.getElementById('contributionChart').getContext('2d');
        new Chart(ctxPie, {
            type: 'doughnut',
            data: {
                // Labels updated to reflect full status tracking
                labels: ['Loyalty Retained (L→L)', 'Upgraded Loyal (N→L)', 'Slipping Loyal (L→N)', 'Normal Repeat (N→N)', 'New/General Customers'],
                datasets: [{
                    data: [621828, 390983, 158317, 290103, dataOthers[2]], // October Data
                    backgroundColor: ['#10b981', '#6366f1', '#f59e0b', '#9ca3af', '#3498DB'], // Changed Others color to Blue to link with Growth Driver
                    hoverOffset: 10,
                    borderWidth: 2,
                    borderColor: '#ffffff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: {
                    padding: 20
                },
                plugins: {
                    legend: { 
                        position: 'right', 
                        labels: { 
                            boxWidth: 15, 
                            font: { family: "'Prompt', sans-serif", size: 12 },
                            padding: 20
                        } 
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.95)',
                        titleColor: '#1f2937',
                        bodyColor: '#4b5563',
                        borderColor: '#e5e7eb',
                        borderWidth: 1,
                        padding: 10,
                        titleFont: { family: "'Prompt', sans-serif", size: 14, weight: 'bold' },
                        bodyFont: { family: "'Prompt', sans-serif", size: 13 },
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                let value = context.raw;
                                let total = context.chart._metasets[context.datasetIndex].total;
                                let percentage = ((value / total) * 100).toFixed(1) + "%";
                                let money = new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB' }).format(value);
                                return ` ${label}: ${percentage} (${money})`;
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
